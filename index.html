<!DOCTYPE html>
  <html>
     <head>
       <title>test</title>
     </head>
     <style>
    </style>
  <body>
    <div class="wrapper">
      <div class="main">
      </div>
   <div>
  </body>
  <script>
    const jsonp = function(url,data){
  return new Promise((resolve,reject)=>{

    //初始化url
    let urlString = url.indexOf('?') === -1 ? '?':'&'
    let callbackName = `cbFn` 
    url += `${urlString}callback=${callbackName}`
    if(data){
      for(let k in data){
          url+=`&${k}=${data[k]}`
      }
    }   

    let jsNode = document.createElement('script')
    jsNode.src = url
    document.body.appendChild(jsNode)

    window[callbackName] = result =>{
      delete window[callbackName]
      document.body.removeChild(jsNode)
      if (result) {
        resolve(result)
      } else {
        reject('没有返回数据')
      }
    }
    
  })
}

jsonp('http://192.168.0.103:8081/jsonp', 
    {a: 1, b: 'ha'})
  .then(result => { console.log(result) })
  .catch(err => { console.error(err) })
  </script>
 </html>
